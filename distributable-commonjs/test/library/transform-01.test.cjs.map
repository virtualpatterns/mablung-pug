{"version":3,"sources":["../../../source/test/library/transform-01.test.js"],"names":["Parse","DefaultParser","ModuleParser","Traverse","DefaultTraverse","default","ModuleTraverse","FilePath","__filename","FolderPath","Path","dirname","Require","require","test","sourcePath","targetPath","extname","is","Transform","createModuleFromPath","true","FileSystem","pathExists","throwsAsync","notThrowsAsync","undefined","utilityPath","relative","resolve","content","readFile","ast","existsUtility","CallExpression","path","node","callee","name","arguments","length","type","value","ImportDeclaration","source","deepEqual","forEach","pathExistsSync"],"mappings":"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","sourcesContent":["import DefaultParser, * as ModuleParser from '@babel/parser'\nimport FileSystem from 'fs-extra'\nimport Path from 'path'\nimport Test from 'ava'\nimport Touch from 'touch'\nimport DefaultTraverse, * as ModuleTraverse from '@babel/traverse'\n\nimport { Transform } from '../../index.js'\n\nconst { 'parse': Parse } = DefaultParser || ModuleParser\nconst Traverse = DefaultTraverse.default || ModuleTraverse.default\nconst FilePath = __filePath\nconst FolderPath = Path.dirname(FilePath)\nconst Require = __require\n\nTest('createModuleFromPath(sourcePath, targetPath, option) using file', async (test) => {\n\n  let sourcePath = `${FolderPath}/resource/transform-01/file/00-content.pug`\n  let targetPath = `${FolderPath}/resource/transform-01/file/00-content${Path.extname(FilePath)}`\n\n  // succeeds writing target\n  // await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath))\n  test.is(await Transform.createModuleFromPath(sourcePath), targetPath)\n  test.true(await FileSystem.pathExists(targetPath))\n\n  // succeeds (but writes nothing) with no change to source\n  // await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath))\n  test.is(await Transform.createModuleFromPath(sourcePath), targetPath)\n\n  // fails to overwrite as 'flag' defaults to 'wx' with changed source \n  await Touch(sourcePath)\n  await test.throwsAsync(Transform.createModuleFromPath(sourcePath), { 'code': 'EEXIST'})\n\n  // succeeds to overwrite as 'flag' is 'w' with changed source \n  await Touch(sourcePath)\n  await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath, undefined, { 'flag': 'w' }))\n\n  // succeeds to overwrite as 'flag' is 'w' with changed source, utility import is defined\n  let utilityPath = Path.relative(Path.dirname(sourcePath), Require.resolve(`../../library/utility${Path.extname(FilePath)}`))\n\n  await Touch(sourcePath)\n  await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath, undefined, { 'flag': 'w', 'utility': utilityPath }))\n\n  let content = await FileSystem.readFile(targetPath, { 'encoding': 'utf-8' })\n  let ast = Parse(content, { 'sourceType': 'module' })\n\n  let existsUtility = false \n\n  Traverse(ast, {\n    CallExpression(path) {\n\n      if (path.node.callee.name === 'require' &&\n          path.node.arguments.length === 1 &&\n          path.node.arguments[0].type === 'StringLiteral') {\n\n        // test.log(`const Utility = require('${path.node.arguments[0].value}')`)\n        test.is(path.node.arguments[0].value, utilityPath)\n\n        existsUtility = true\n\n      }\n\n    },\n    ImportDeclaration(path) {\n\n      // test.log(`import Utility from '${path.node.source.value}'`)\n      test.is(path.node.source.value, utilityPath)\n\n      existsUtility = true\n\n    }\n  })\n\n  test.true(existsUtility)\n\n})\n\nTest('createModuleFromPath(sourcePath, targetPath, option) using folder', async (test) => {\n\n  let sourcePath = `${FolderPath}/resource/transform-01/folder`\n  let targetPath = [\n    `${FolderPath}/resource/transform-01/folder/00-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/folder/01-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/folder/02-content${Path.extname(FilePath)}`\n  ]\n\n  // succeeds writing target\n  test.deepEqual(await Transform.createModuleFromPath(sourcePath), targetPath)\n  targetPath.forEach((targetPath) => test.true(FileSystem.pathExistsSync(targetPath)))\n\n  // succeeds (but writes nothing) with no change to source\n  test.deepEqual(await Transform.createModuleFromPath(sourcePath), targetPath)\n\n  // fails to overwrite as 'flag' defaults to 'wx' with changed source \n  await Touch(`${sourcePath}/02-content.pug`)\n  await test.throwsAsync(Transform.createModuleFromPath(sourcePath), { 'code': 'EEXIST'})\n\n  // succeeds to overwrite as 'flag' is 'w' with changed source \n  await Touch(`${sourcePath}/02-content.pug`)\n  await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath, undefined, { 'flag': 'w' }))\n\n})\n\nTest('createModuleFromPath(sourcePath, targetPath, option) using sub-folder', async (test) => {\n\n  let sourcePath = `${FolderPath}/resource/transform-01/sub-folder`\n  let targetPath = [\n    `${FolderPath}/resource/transform-01/sub-folder/folder/00-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/folder/01-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/folder/02-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/00-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/01-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/02-content${Path.extname(FilePath)}`\n  ]\n\n  // succeeds writing target\n  test.deepEqual(await Transform.createModuleFromPath(sourcePath), targetPath)\n  targetPath.forEach((targetPath) => test.true(FileSystem.pathExistsSync(targetPath)))\n\n  // succeeds (but writes nothing) with no change to source\n  test.deepEqual(await Transform.createModuleFromPath(sourcePath), targetPath)\n\n  // fails to overwrite as 'flag' defaults to 'wx' with changed source \n  await Touch(`${sourcePath}/folder/02-content.pug`)\n  await Touch(`${sourcePath}/02-content.pug`)\n  await test.throwsAsync(Transform.createModuleFromPath(sourcePath), { 'code': 'EEXIST'})\n\n  // succeeds to overwrite as 'flag' is 'w' with changed source \n  await Touch(`${sourcePath}/folder/02-content.pug`)\n  await Touch(`${sourcePath}/02-content.pug`)\n  await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath, undefined, { 'flag': 'w' }))\n\n})\n"],"file":"transform-01.test.cjs"}