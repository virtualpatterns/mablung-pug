{"version":3,"sources":["../../../source/test/library/transform-01.test.js"],"names":["DefaultParser","ModuleParser","FileSystem","Path","Test","Touch","DefaultTraverse","ModuleTraverse","Transform","Parse","Traverse","default","FilePath","_URL","fileURLToPath","import","meta","url","FolderPath","dirname","Require","_createRequire","test","sourcePath","targetPath","extname","is","createModuleFromPath","true","pathExists","throwsAsync","notThrowsAsync","undefined","utilityPath","relative","resolve","content","readFile","ast","existsUtility","CallExpression","path","node","callee","name","arguments","length","type","value","ImportDeclaration","source","deepEqual","forEach","pathExistsSync"],"mappings":"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","sourcesContent":["import DefaultParser, * as ModuleParser from '@babel/parser'\nimport FileSystem from 'fs-extra'\nimport Path from 'path'\nimport Test from 'ava'\nimport Touch from 'touch'\nimport DefaultTraverse, * as ModuleTraverse from '@babel/traverse'\n\nimport { Transform } from '../../index.js'\n\nconst { 'parse': Parse } = DefaultParser || ModuleParser\nconst Traverse = DefaultTraverse.default || ModuleTraverse.default\nconst FilePath = __filePath\nconst FolderPath = Path.dirname(FilePath)\nconst Require = __require\n\nTest('createModuleFromPath(sourcePath, targetPath, option) using file', async (test) => {\n\n  let sourcePath = `${FolderPath}/resource/transform-01/file/00-content.pug`\n  let targetPath = `${FolderPath}/resource/transform-01/file/00-content${Path.extname(FilePath)}`\n\n  // succeeds writing target\n  // await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath))\n  test.is(await Transform.createModuleFromPath(sourcePath), targetPath)\n  test.true(await FileSystem.pathExists(targetPath))\n\n  // succeeds (but writes nothing) with no change to source\n  // await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath))\n  test.is(await Transform.createModuleFromPath(sourcePath), targetPath)\n\n  // fails to overwrite as 'flag' defaults to 'wx' with changed source \n  await Touch(sourcePath)\n  await test.throwsAsync(Transform.createModuleFromPath(sourcePath), { 'code': 'EEXIST'})\n\n  // succeeds to overwrite as 'flag' is 'w' with changed source \n  await Touch(sourcePath)\n  await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath, undefined, { 'flag': 'w' }))\n\n  // succeeds to overwrite as 'flag' is 'w' with changed source, utility import is defined\n  let utilityPath = Path.relative(Path.dirname(sourcePath), Require.resolve(`../../library/utility${Path.extname(FilePath)}`))\n\n  await Touch(sourcePath)\n  await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath, undefined, { 'flag': 'w', 'utility': utilityPath }))\n\n  let content = await FileSystem.readFile(targetPath, { 'encoding': 'utf-8' })\n  let ast = Parse(content, { 'sourceType': 'module' })\n\n  let existsUtility = false \n\n  Traverse(ast, {\n    CallExpression(path) {\n\n      if (path.node.callee.name === 'require' &&\n          path.node.arguments.length === 1 &&\n          path.node.arguments[0].type === 'StringLiteral') {\n\n        // test.log(`const Utility = require('${path.node.arguments[0].value}')`)\n        test.is(path.node.arguments[0].value, utilityPath)\n\n        existsUtility = true\n\n      }\n\n    },\n    ImportDeclaration(path) {\n\n      // test.log(`import Utility from '${path.node.source.value}'`)\n      test.is(path.node.source.value, utilityPath)\n\n      existsUtility = true\n\n    }\n  })\n\n  test.true(existsUtility)\n\n})\n\nTest('createModuleFromPath(sourcePath, targetPath, option) using folder', async (test) => {\n\n  let sourcePath = `${FolderPath}/resource/transform-01/folder`\n  let targetPath = [\n    `${FolderPath}/resource/transform-01/folder/00-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/folder/01-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/folder/02-content${Path.extname(FilePath)}`\n  ]\n\n  // succeeds writing target\n  test.deepEqual(await Transform.createModuleFromPath(sourcePath), targetPath)\n  targetPath.forEach((targetPath) => test.true(FileSystem.pathExistsSync(targetPath)))\n\n  // succeeds (but writes nothing) with no change to source\n  test.deepEqual(await Transform.createModuleFromPath(sourcePath), targetPath)\n\n  // fails to overwrite as 'flag' defaults to 'wx' with changed source \n  await Touch(`${sourcePath}/02-content.pug`)\n  await test.throwsAsync(Transform.createModuleFromPath(sourcePath), { 'code': 'EEXIST'})\n\n  // succeeds to overwrite as 'flag' is 'w' with changed source \n  await Touch(`${sourcePath}/02-content.pug`)\n  await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath, undefined, { 'flag': 'w' }))\n\n})\n\nTest('createModuleFromPath(sourcePath, targetPath, option) using sub-folder', async (test) => {\n\n  let sourcePath = `${FolderPath}/resource/transform-01/sub-folder`\n  let targetPath = [\n    `${FolderPath}/resource/transform-01/sub-folder/folder/00-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/folder/01-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/folder/02-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/00-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/01-content${Path.extname(FilePath)}`,\n    `${FolderPath}/resource/transform-01/sub-folder/02-content${Path.extname(FilePath)}`\n  ]\n\n  // succeeds writing target\n  test.deepEqual(await Transform.createModuleFromPath(sourcePath), targetPath)\n  targetPath.forEach((targetPath) => test.true(FileSystem.pathExistsSync(targetPath)))\n\n  // succeeds (but writes nothing) with no change to source\n  test.deepEqual(await Transform.createModuleFromPath(sourcePath), targetPath)\n\n  // fails to overwrite as 'flag' defaults to 'wx' with changed source \n  await Touch(`${sourcePath}/folder/02-content.pug`)\n  await Touch(`${sourcePath}/02-content.pug`)\n  await test.throwsAsync(Transform.createModuleFromPath(sourcePath), { 'code': 'EEXIST'})\n\n  // succeeds to overwrite as 'flag' is 'w' with changed source \n  await Touch(`${sourcePath}/folder/02-content.pug`)\n  await Touch(`${sourcePath}/02-content.pug`)\n  await test.notThrowsAsync(Transform.createModuleFromPath(sourcePath, undefined, { 'flag': 'w' }))\n\n})\n"],"file":"transform-01.test.js"}